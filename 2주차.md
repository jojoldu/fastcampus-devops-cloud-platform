# 2주차

## 2-1. Terraform을 통한 VPC 및 EC2 구성

* EC2뿐만 아니라 VPC까지도 Tag 지정할것
* terraform.tfstate는 terraform의 형상을 기록하는 json
    * terraform의 버전관리정도로 보면 될듯
    * 어떤게 업데이트됐고, 어떤게 삭제됐는 등의 모든 기록을 남김
    * 해당 파일을 지우면 더이상 해당 Terraform은 형상관리 하지 않게 되니 주의!
*  

## Q1. Terrafrom이 형상관리가 되면 롤백도 되는가?

* main.tf의 코드를 롤백해서 apply하면 된다.
* state를 롤백한다고 변경되진 않는다

## 2-2. SaltStack을 활용한 웹 서버 구성 이론

* 코드형 인프라 (IaC: Infrasturcture as Code)
    * 소스코드의 버전 관리 기법을 이용하여 인프라를 코드로 정의 후 관리하는 기술
* 구성 관리 툴 (CM Tool)의 Ad-Hoc Script와의 차이점
    * 추상화: 다양한 OS를 추상화된 단일 커맨드로 사용 가능 (우분투/센토스/윈도우의 패키지 매니저를 추상화시켜 관리)
    * 멱등성: **같은 명령을 여러번 수행**하더라도 서버의 상태를 파악하여 **동일한 결과를 제공**
        * 예를 들어 ```wget```으로 레디스 설치파일을 받는다고하면, 해당 파일이 이미 있으면 안받는다든지, 압축을 풀어야하는데 풀린 파일이 있으면 안푼다는지 등등
    * 명령 순서 관리: 명령 실행 순서, 명령 파이프라인등을 지원
    * 플러그인 지원: 커스텀 플러그인 지원

### CM Tool 비교

**Chef**

* Agent 방식으로 Chef Server에 Chef Client들이 주기적으로 자신에게 정의한 Role을 실행한다 (Polling 방식)
* 장점
    * 전통적인 툴이라 문서화가 아주 잘되어 있고, 많은 모듈이 커뮤니티에 존재
    * 명령이 직관적이고, 기본적인 GUI 제공
* 단점
    * 카우치베이스, 솔라등의 소프트웨어 관리가 필요함
        * DB 장애나면 Chef 를 못쓰게 됨
    * 루비 기반의 코드 작성이 필요
    * 폴링 방식이라 푸시 기능이 약함

**SaltStack**

* 장점
    * YAML로 설정 가능
    * 다른 툴에 비해 속도와 단숨함이 뛰어남
    * SaltMaster와 SaltMinion 사이에 메세징 큐를 두어 속도가 아주 빠름
    * 서버 구조가 심플
* 단점
    * GUI가 아주 빈약하여 대부분의 명령은 CLI로 처리해야함
    * 커뮤니티가 별도로 존재하지 않아 내장모듈에서 지원하지 않는 기능은 직접 개발해야함

**Ansible**

* Chef/SaltStack의 경우 모든 서버에 Agent를 설치해야 하기 때문에 Agent가 설치 가능한 X86에 대한 자동화만 가능
* Ansible은 이런 Agent 방식의 한계를 해결하기 위해 나온 툴

* 장점
    * Agent 설치가 필요 없음
    * SaltStack과 같이 자체 내장된 모듈이 많으면 Python + YAML 방식

* 단점
    * WinRM, SSH등을 통해 실행하는 구조라 커넥션 문제라던지 Ansible Server 자체가 병목이 될수 있어 속도가 다른 CM Tool에 비해 많이 느리다
    * Ansible Server가 터널링 통해 명령어 날리는 형태라 모든 서버의 접속 가능한 상태가 되어야한다 => 즉 Ansible Server가 뚫리면 모든 서버가 뚫리는것과 마찬가지다
    * Ansible 자체를 자동화 할 수 있는 API 및 SDK가 아주 빈약하다 (상용버전에선 가능)

* NC의 경우 Ansible로 관리하는 서버가 9000대

### SaltStack 소개

* 과정에서의 실습은 SaltStack을 사용함


## 2-3. SaltStack을 활용한 웹 서버 구성 실습

